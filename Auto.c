#include "Device/Include/stm32f10x.h"   // Device header
#include "ScriptPhase.h"
#include "Delay.h"
#include "Composer.h"
#include "SpecialKeyScan.h"
#include "KeyDisp.h"
#include "VolDisp.h"
#include "Menu.h"
#include "SpecialKeyScan.h"
#include "WaveSel.h"
#include "LCD.h"

const char Carry[]={"063+=.5+==3+=6=1+6==1+==6==1+==3+3+==2+==3+==1+==63+.=5+==6=+6=+6=+3=+5+3+==5+==3+==5+==6+=6+=6+=3+=5+3+x5+=6=3+x5+=6=3+=2#+==3+==1+2+2+2+=1+==2+==3+=5+=6+3++3+3++3+=3++=3+=3++=3+=2+==#3+==1+2+2+2+=1+==2+==3+=5+=6+~"};
const char Farewell[]={"053=5=1+~61+5~51=2=32=1=2~0053=5=1+.7=61+5~52=3=4.7=-1~0061+1+~76=7=1+~6=7=1+=6=6=5=3=1=2~0053=5=1+.7=61+5~52=3=4.7=-1~~0"};
const char Represent[]={"00=5-=5-x1.3=3x5.1=7-.3=50=5=5x6=71+.6=6=6x5=5~~3=2=1.1=13=2=1.1=12=2x3=3x21=6-2=3=3x2~~0=5-=5x1.3=3x5.1=7-.3=50=5=5x6=71+.6=6=6x5=5~~3=2=1.1=13=2=1.1=12=2x3=3x2.6=-7-1=2=2x1~~3=5=3.2=157-~~6=-7=-6-.7=-6-.5-3~~53.2=157-~~6=-7=-1.1=12=3=2~~0=5-=5-x1.3=3x5.1=7.-3=5.5=5x6.7=1+.6=6=6x5=5~3=2=1.1=13=2=41.1=12=3=3x2.6=-7-1=2=1~~0"};
const char BlueGeniue[]={"03==4==5=3+=1+=5=3.2==3==4=2+=7=4=2+.1==2==3=2==3==4=3==4==5=3==4==6=5==6==7==1+==1+#==2+==2+==3+==4+==4+#==5+=0=5-1=3=5-=3=1=3=5-=3==4==5=4=3=4=5=4=3=4=5=5==4#==5=3=7.2==3==4=3=5=2+=7.2==3==4=3=4=6=5.3==4==5=4=3=4=5=4=3=4=5=5==4#==5=3+=2+.2==3==4=3=4=2+=1+=7=6=7=1+~1+553+=3+=1+53~"};
const char BadApple[]={"06=7=1+=2+=3+6+=5+=3+6=.0==3+=2+=1+=7=6=7=1+=2+=3+.=0==2+=1+=7=6=7=1+=7=6=5#=7=6=7=1=+2+=3+=.0==6+=5+=3+.=0==63+=2+=1+=7=6=7=1+=2+=3+=.0==2+=1+=7=.0==1+=.0==2+3+6=7=1+=2=+3+6+=5+=3+6=.0==3+=2+=1+=7=6=7=1+=2+=3+=.0==2+=1+=7=6=7=1+=7=6=5#=7=6=7=1+=2+=3+=.0==6+=5+=3+=.0==63+=2+=1+=7=6=7=1+=2+=3+=.0==2+=1+=7=.0==1+.=0==2+3+1++==6+==1++==6+==1++==6+==1++==6+==1++==6+==1++==6+==1++==6+==1++==6+==2++==7+==2++==7+==2++==7+==2++==7+==2++==7+==2++==7+==2++==7+==2++==7+==3++==1++==3++==1++==3++==1++==3++==1++==3++==1++==3++==1++==3++==1++==3++==1++==3++==1++==3++==1++==3++==1++==3++==1++==2++=1++==2++==1++=6+==7+==6+==4+==6+==4+==6+==4+==6+==4+==6+==4+==6+==4+==6+==4+==6+==4+==7+==5+==7+==5+==7+==5+==7+==5+==7+==5+==7+==5+==7+==5+==7+==5+==1++==6+==1++==6+==1++==6+==1++==6+==1++==6+==1++==6+==1++==6+==1++==6+==1++==6+==1++==6+==6+==1+==6+==0==6+=3+==1+==6==0==0==3+==5+=6+=3+=2+=3+2+=3+=5+=6+=3+=2+=3+.=0==2+=3+=2+=1+=7=6=6.=0==5=6=7=1+=2+=3+=6.=0==2+=3+=5+=6+=3+=2+=3+2+=3+=5+=6+=3+=2+=3+6+=7+=1++=7+=6+=5+=3+.=0==2+=3+=2+=1+=7=5=6.0=6+~~~5+~~2+2+=3+.3+~0=0=2+=1+=7=5=2=3=6~~6=7==1.==2+~~2+==1+==7==5==6~~00==7.=1+=2+=3+=6+.6.~~6+=5+==4+==3+~2+1+.=0==7.=1+==1+=5+=5+~3+~~2+=3+=5+=6+=3+=2+=3+.=0==2+=3+=5+=6+=3+=2+=3+.=0==6+=7+=1++=7+=6+=5+=3+.=0==2+=3+=2+=1+=7=5=60"};
const char _9981[]={"16-=5-=6-=3=2=3==2==1=2=3=2=3=5=3=5==3==2=3==4==6-=5-=6-=3=2=3==2==1=2=3=2=3=2=35==3==2==1==6-=5-=6-=3=2=3==2==1=2=3=2=3=5=3=5==3==2=3==4==6-=5-=6-=3=2=3==2==1=2=6-=5-=6-=5-=6-~6~~~3+5+3+2+=3+==2+==62+3+1+=2+=5+3+2+3+6~~~1+5+3+2+2+~1+.2+=52+1+76~~~3+5+3+2+2+~3+~5+6+=5+==3+==2+3+6.5+=2+3+1+5+3+2+2+~1+~51+=2+=1+766+6+2+=1+=2+=2+=1+3+=3+=3+=2+=1+=2+2+=1+=2+2+=1+=2+=3+5+=5+=2+3+=3+6+6+2+=1+=2+=3+=5+=3+=0=3+=2+=1+=2+2+=1+=2+2+=1+=3+=2+6=6=56=66+6+2+=1+=2+=1+3+=0=3+=2+=1+=2+2+=1+=2+2+=1+=2+=3+5+=5+=2+3+=3+6+6+2+=1+=2+=3+=5+=3+=0=3+=2+=1+=2+2+=1+=2+2+=1+=3+=2+6=6=56=61+766=5=5=65=66=56=56=5=5=6=56=1+2+=3+=2+3+=2+=2+3+=3+~03=5=6=53+=3+=2+=1+=2+=3+=5+=6+=3+=0=3+=2+=1+=2+=.3+==3+=6=0=3+=2+=1+=2+=.3+==3+=5+=2+=1+=6=1+=2+=.1+==1+=3+=0=2+=1+=2+=3+=5+=6+=3+3+=2+=1+=2+=.1+==1+=2+=2+=.1+==1+=2+=2+=1+=2+=3+=2+=1+=6=6=2+=1+3+=3+=2+=1+=2+=3+=5+=6+=3+3+=2+=1+=2+=.3+==3+=6=0=3+=2+=1+=2+=.3+==3+=5+=2+=1+=6=1+=2+=.1+==1+=3+=0=2+=1+=2+=3+=5+=6+=3+3+=2+=1+=2+=.1+==1+=2+=2+=.1+==1+=2+=2+=1+=2+=3+=2+=1+=1+=5=6~~~6+6+2+=1+=2+=2+=1+3+=3+=3+=2+=1+=2+2+=1+=2+2+=1+=2+=3+5+=5+=2+3+=3+6+6+2+=1+=2+=3+=5+=3+=0=3+=2+=1+=2+2+=1+=2+2+=1+=2+=3+2+=2+=1+6=66+6+2+=1+=2+=1+3+=0=3+=2+=1+=2+2+=1+=2+2+=1+=2+=3+5+=5+=2+3+=3+6+6+2+=1+=2+=3+=5+=3+=0=3+=2+=1+=2+2+=1+=2+2+=1+=2+=3+2+=2+=1+6=61+766=5=5=65=66=56=56=5=5=6=56=1+2+=3+=2+3+=2+=2+3+=3+~03=5=6=53+=3+=2+=1+=2+=3+=5+=6+=3+=0=3+=2+=1+=2+=.3+==3+=6=0=3+=2+=1+=2+=.3+==3+=5+=2+=1+=6=1+=2+=.1+==1+=3+=0=2+=1+=2+=3+=5+=6+=3+3+=2+=1+=2+=.1+==1+=2+=2+=.1+==1+=2+=2+=1+=2+=3+=2+=1+=6=1+=2+=1+3+=3+=2+=1+=2+=3+=5+=6+=3+3+=2+=1+=2+=.3+==3+=6=0=3+=2+=1+=2+=.3+==3+=5+=2+=1+=6=1+=2+=.1+==1+=3+=0=2+=1+=2+=3+=5+=6+=3+3+=2+=1+=2+=.1+==1+=2+=2+=.1+==1+=2+=2+=1+=2+=3+=2+=1+=1+=5=6~~~6~5=6=62+=1+=6=5=6=1+=6121=7-=6-=5-=6+.5+=3+=2+=3+=5+=12=3=2=5-=6-=6-=12=3=2=5-=5-=5-=1+=2+=5+3+=2+=1+2+6~~5-122=1=6-=5-=6-=3=5=3=2=3=6=1+=3+=2+=2+=5=3=2=6=5=66=5=6=1+=2+=1+=2+=1+=2+=1+=2+=3+=5+~2+=3+=5+1++~7+~7+~~3=5=6=53+=3+=2+=1+=2+=3+=5+=6+=3+=0=3+=2+=1+=2+=.3+==3+=6=0=3+=2+=1+=2+=.3+==3+=5+=2+=1+=6=1+=2+=.1+==1+=3+=0=2+=1+=2+=3+=5+=6+=3+3+=2+=1+=2+=.1+==1+=2+=2+=.1+==1+=2+=2+=1+=2+=3+==2+==2+3=5=6=53+=3+=2+=1+=2+=3+=5+=6+=3+3+=2+=1+=2+=.3+==3+=6=0=3+=2+=1+=2+=.3+==3+=5+=2+=1+=6=1+=2+=.1+==1+=3+=0=2+=1+=2+=3+=5+=6+=3+3+=2+=1+=2+=.1+==1+=2+=2+=.1+==1+=2+=2+=1+=2+=3+=2+=1+=6=1+=6=53+=3+=2+=1+=2+=3+=5+=6+=3+3+=2+=1+=2+=.3+==3+=6=0=3+=2+=1+=2+=.3+==3+=5+=2+=1+=6=1+=2+=.1+==1+=3+=0=2+=1+=2+=3+=5+=6+=3+3+=2+=1+=2+=.1+==1+=2+=2+=.1+==1+=2+=2+=1+=2+=3+=2+=1+=6=1+=6=1+=2+=1+=2+=3+=5+=3+=3+=5+=6+~~~6+~~~"};
const char Test[]={"011#22#344#55#66#71+1+#2+2+#3+4+4+#5+5+#6+6+#7+1++1++#2++2++#3++4++4++#5++5++#6++6++#7++1+++"};

void MenuCallbackPlay(u32 Tag);

const struct MenuStruct SongList[]={
	"Pigman Carry Wife",&MenuCallbackPlay,(u32)Carry,
	"Farewell",&MenuCallbackPlay,(u32)Farewell,
	"Represent",&MenuCallbackPlay,(u32)Represent,
	"BlueGeniue",&MenuCallbackPlay,(u32)BlueGeniue,
	"BadApple",&MenuCallbackPlay,(u32)BadApple,
	"9*9=81",&MenuCallbackPlay,(u32)_9981,
	"Test",&MenuCallbackPlay,(u32)Test,
	0,0,0,
};

void Play(const char* Song)
{
	RefreshKeyDisp();
	VolDisp(GetVol());
	LCDDrawText(10,10,GREEN,GRAY2,"Auto Play:");
	LCDDrawText(10,30,GREEN,GRAY2,"Keyboard disabled.");
	LCDDrawText(10,50,GREEN,GRAY2,"Left=Back");
	LCDDrawText(10,70,GREEN,GRAY2,"Right=Change wave type");
	SetBaseTone((*Song)-'0');
	LoadScript(Song+1);
	
	PreciseDelay(0);
	while(1)
	{
		u8 Ctrl=SpecialKeyGetCtrl();
		signed short Enc=SpecialKeyGetEnc();
		if(Ctrl & 1)
		{
			break;
		}
		if(Ctrl & 2)
		{
			SetAllTuneDisable();
			SetAllKeyDispDisable();
			WaveSel();
			RefreshKeyDisp();
			VolDisp(GetVol());
			LCDDrawText(10,10,GREEN,GRAY2,"Auto Play:");
			LCDDrawText(10,30,GREEN,GRAY2,"Keyboard disabled.");
			LCDDrawText(10,50,GREEN,GRAY2,"Left=Back");
			LCDDrawText(10,70,GREEN,GRAY2,"Right=Change wave type");
		}
		if(Enc)
		{
			signed short Vol=GetVol()+Enc*5;
			if(Vol>255)
			{
				Vol=255;
			}
			if(Vol<0)
			{
				Vol=0;
			}
			SetVol(Vol);
			VolDisp(Vol);
		}
		if(ScriptTick()!=1)
		{
			LoadScript(Song);
			Delay(1000);
		}
		PreciseDelay(10);
	}
	SetAllTuneDisable();
	SetAllKeyDispDisable();
}

void MenuCallbackPlay(u32 Tag)
{
	Play((const char*)Tag);
}

void DispSongList(void)
{
	EnterMenu(SongList);
}
